<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <title>Audio Spectrum Analyzer</title>    
</head>
<body>
    <div class="container">
            <h1>Audio Spectrum Analyzer</h1>
            <div>nejimon.raveendran</div>
            <h2>Web Display Configuration</h2>            
            <div id="msg"></div>
            <div class="header">
            <div class="menucontainer">
                <div>configuration</div>
                <div class="menu">
                    <a href="index.html" title="Home"><i class="fa-solid fa-house"></i></i></a>  
                    <a href="led-display-config.html" title="LED Display Config"><i class="fa-regular fa-circle-dot"></i></a>  
                    <a href="console-display-config.html" title="Console Display Config"><i class="fa-regular fa-window-maximize"></i></a>    
                </div>
            </div>    
        </div>

        <div class="line"></div>
        
        <div style="width: 50px;height: 50px; background-color: red;overflow: hidden;border-radius: 50%;">
            <input type="color" value="#ffffff" style="width:200px;height:200px;cursor:pointer;transform: translate(-50%, -50%);"/>
        </div>

        <div class="content">
            <!--  -->
        </div>      
        <hr>  
    </div>

    <script>
        let _webDisplayConfig;
        $(document).ready(() => {
            _webDisplayConfig = new WebDisplayConfig('.content');
        });



        class WebDisplayConfig  {
            constructor(parentElement) {
                this._parentElement = parentElement;
                this._winWid = window.innerWidth;
                this._winHgt = window.innerHeight;
                this._tblMatrixId = 'tblMatrix';
                this._gradientTopId = 'gradientTop';
                this._gradientBottomId = 'gradientBottom';
                this._cols = 16;
                this._rows = 16;
                this._pixelColors = [,];
                this._peakColor = '#ffffff';
                this._blackPixel = 'black';
                this._transitionSpeed = 2;
                this._peakWait = 500;
                this._peakWaitCountDown = 20;
                this._showPeaks = true;
                this._pixelWid = this._winWid / (this._cols * 2);
                this._pixelHgt =  this._pixelWid;       



                this.setupDefaultColors();
                this.buildConfigUi();
            }

            loadConfig() {
                //
            }

            saveConfig(newConfig) {
                //
            }

            buildConfigUi(){
                let html = '';
                html = `<div id="configContainer" style="width: 100%; display: flex; flex-direction: column; align-items: center; padding: 10px;">`;
                html = this.buildSliders(html);
                html = this.buildToggles(html);
                html = this.builPeakColor(html);
                html = this.buildMatrix(html);
                html = this.buildDeployButton(html);
                html += `</div>`;

                $(this._parentElement).html(html);

            }

            buildSliders(html){
                html += `<div id="slidersContainer" style="width: 100%; display: flex; flex-direction: column; align-items: start; padding: 10px;">`;
                html += `<label>Peak wait</label>`;
                html += `<input id="sldPeakWait" type="range" min="1" max="100" step="1" value="25" style="width:100%;margin-bottom:20px;"/>`;
                
                html += `<label>Peak speed</label>`;
                html += `<input id="sldPeakFalldown" type="range" min="1" max="100" step="1" value="25" style="width:100%;margin-bottom:20px;"/>`;
                
                html += `<label>Level smoothness</label>`;
                html += `<input id="sldTransitionSpeed" type="range" min="1" max="100" step="1" value="25" style="width:100%;margin-bottom:20px;"/>`;
                
                html += `<label>Level strength</label>`;
                html += `<input id="sldAmplification" type="range" min="1" max="100" step="1" value="25" style="width:100%;margin-bottom:20px;"/>`;

                html += `<label>Brightness</label>`;
                html += `<input id="sldBrightness" type="range" min="1" max="100" step="1" value="25" style="width:100%;margin-bottom:20px;"/>`;

                html += `</div>`;
                return html;
            }

            buildToggles(html){
                html += `<div id="togglesContainer" style="width: 100%; display: flex; flex-direction: row; align-items: start; padding-left: 20px;">`;
                html += `<input id="chkShowPeak" type="checkbox" checked="1"/>`;
                html += `<label>Show peaks</label>`;

                html += `<input id="chkShowPeaksWhenSilent" type="checkbox" checked style="margin-left: 50px;"/>`;
                html += `<label>Show bttom peaks when silent</label>`;

                html += `</div>`;
                return html;
            }


            builPeakColor(html) {
                html += `<div id="peakColorContainer" style="width: 100%; display: flex; flex-direction: column; align-items: center; padding:10px;">`;
                html += `<label>Peak Color</label>`;
                html += `<div style="width:${this._pixelWid}px;height:${this._pixelHgt}px;overflow:hidden;border-radius:20%;">`;
                html += `<input type="color" id="peakColor" value="${this._peakColor}" style="cursor:pointer;width:${this._pixelWid * 3}px; height:${this._pixelHgt * 3}px; transform:translate(-50%, -50%);"/>`;
                html += `</div>`;
                html += `</div>`;
                return html;
            }

            buildMatrix(html) {
                let gradientPickerHeight = (this._pixelHgt * this._rows) / 2;
                
                html += `<table id="${this._tblMatrixId}">`;
                
                for (let y = this._rows-1; y >= 0; y--) {  
                    let hue = this.map(y, 0, this._rows, 100, 0);
                    let color =  `hsl(${hue}, 100%, 50%)`;  

                    html += '<tr>';
                    if (y == this._rows-1) {
                        html += `<td rowspan="${this._rows}">`;
                        html += `<p><i class="fa-solid fa-fill-drip"></i></p>`;
                        html += `<div><input id="${this._gradientTopId}" type="color" value="#ffffff" style="height:${gradientPickerHeight}px; width:30px;cursor:pointer;"/></div>`;
                        html += `<div><input id="${this._gradientBottomId}" type="color" value="#ffffff" style="height:${gradientPickerHeight}px; width:30px;cursor:pointer;"/></div>`;
                        html += `</td>`;
                    }

                    for (let x = 0; x < this._cols; x++) {
                        this._pixelColors[x, y] = color;

                        html += `<td>
                        <div style="width:${this._pixelWid}px;height:${this._pixelHgt}px;overflow:hidden;cursor:pointer;border-radius:20%;">
                        <input type="color" value="#ffffff" data-px-x="${x}" data-px-y="${y}"  
                        style=" 
                        width:${this._pixelWid*3}px;
                        height:${this._pixelWid*3}px;
                        cursor: pointer;
                        transform: translate(-50%, -50%);
                        "></input>
                        </div>
                        </td>`;

                    }

                    html += '</tr>';
                }

                html += '</table>';

                return html;
            }

            buildDeployButton(html){
                html += `<div id="deployButtonContainer" style="width: 100%; display: flex; flex-direction: row; justify-content: center; margin-top: 20px;">`;
                html += `<button class="btnDeploy" style="width:200px;height:100px;background-color:rgb(139, 187, 250);cursor:pointer;font-weight: bolder;">Deploy</button>`;
                html += `</div>`;
                return html;
            }


            setupDefaultColors() {
                for (let x = 0; x < this._cols; x++)
                {
                    for (let y = 0; y < this._rows; y++)
                    {
                        let hueIndex = this.map(y, 0, this._rows-1, 100, 0); //map row numbers to the color range green to red
                        this._pixelColors[x, y] =  `hsl(${hueIndex}, 100%, 50%)`;
                    }            
                }
            }

                 
            map(value, fromMin, fromMax, toMin, toMax){
                return toMin + (value - fromMin) * (toMax - toMin) / (fromMax - fromMin);
            }


        }
    </script>
</body>
</html>